<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>×”×¤×§×ª ×”×¦×¢×ª ××—×™×¨</title>

  <!-- PDF: HTML -> PDF (×ª×•××š ×‘×¢×‘×¨×™×ª) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#fff; }
    h2 { margin: 0 0 10px; }
    .section {
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 14px;
      margin-bottom: 18px;
      background: #fafafa;
    }
    label { display:block; margin-top:10px; font-weight:700; }
    input, select {
      width:100%; padding:8px; margin-top:4px; box-sizing:border-box;
      border:1px solid #d1d5db; border-radius:8px;
    }
    button { padding: 8px 16px; cursor:pointer; font-size:14px; border-radius:10px; border:0; }
    .primary { background:#1f6feb; color:#fff; }
    .secondary { background:#e5e7eb; }
    table { width:100%; border-collapse:collapse; margin-top:14px; }
    th, td { border-bottom:1px solid #ddd; padding:8px; text-align:right; }
    th { background:#1f2a44; color:#fff; }
    .total { margin-top: 16px; font-size: 18px; font-weight: 800; }
    .delete-btn { background:none; border:none; font-size:18px; cursor:pointer; }
    dialog { border-radius: 12px; padding: 16px; border:0; width:min(520px, 92vw); }
    .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* ====== PDF Template Styles ====== */
    #pdfWrap { display:none; } /* ××•×¡×ª×¨ ×‘×“×£, ××©××© ×¨×§ ×œ×”×“×¤×¡×” ×œ-PDF */
    .pdf {
      direction: rtl;
      font-family: Arial, sans-serif;
      color:#111;
      padding: 18mm 15mm;
      background:#fff;
    }
    .pdf-header {
      text-align:center;
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 14px;
    }
    .pdf-meta {
      display:flex;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
      font-size: 12px;
    }
    .pdf-meta .box {
      width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 10px;
    }
    .pdf-meta .box strong { display:inline-block; min-width: 80px; }
    .pdf-table { width:100%; border-collapse:collapse; margin-top: 10px; }
    .pdf-table th {
      background:#1f2a44;
      color:#fff;
      padding:8px;
      font-size: 12px;
      border:1px solid #1f2a44;
    }
    .pdf-table td {
      padding:8px;
      font-size: 12px;
      border:1px solid #e5e7eb;
    }
    .pdf-summary {
      margin-top: 12px;
      display:flex;
      justify-content: flex-start;
      gap: 14px;
      align-items: center;
      font-size: 14px;
      font-weight: 800;
    }
    .pdf-line { margin-top: 10px; border-top: 1px solid #e5e7eb; }
    .pdf-footer { margin-top: 10px; font-size: 11px; color:#6b7280; }
  </style>
</head>

<body>

  <h2>×”×¤×§×ª ×”×¦×¢×ª ××—×™×¨</h2>

  <!-- ×¤×¨×˜×™ ×œ×§×•×— -->
  <div class="section">
    <h3 style="margin:0 0 8px;">×¤×¨×˜×™ ×œ×§×•×—</h3>
    <label>×©× ×œ×§×•×—
      <input type="text" id="customerName" placeholder="×œ×“×•×’××”: ×™×©×¨××œ ×™×©×¨××œ×™">
    </label>
    <label>××¡×¤×¨ ×œ×§×•×—
      <input type="text" id="customerId" placeholder="×œ×“×•×’××”: 10234">
    </label>
    <label>×›×ª×•×‘×ª ××™×™×œ
      <input type="email" id="customerEmail" placeholder="example@email.com">
    </label>
  </div>

  <!-- ×¤×¨×™×˜×™× -->
  <div class="section">
    <div class="row">
      <h3 style="margin:0;">×¤×¨×™×˜×™×</h3>
      <button class="primary" onclick="openDialog()">â• ×”×•×¡×£ ×¤×¨×™×˜</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>×¤×¨×™×˜</th>
          <th>×¦×‘×¢</th>
          <th>×›××•×ª</th>
          <th>××•×¨×š (××³)</th>
          <th>××—×™×¨ ×©×•×¨×” (â‚ª)</th>
          <th>××—×™×§×”</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>

    <div class="total">
      ×¡×”×´×› ×œ×”×–×× ×”: â‚ª <span id="grandTotal">0.00</span>
    </div>

    <div class="row" style="margin-top:14px;">
      <button class="primary" onclick="generatePDF()">ğŸ“„ ×”×¤×§ ×”×¦×¢×ª ××—×™×¨</button>
    </div>
  </div>

  <!-- ×—×œ×•× ×™×ª ×”×•×¡×¤×ª ×¤×¨×™×˜ -->
  <dialog id="dlg">
    <label>×¤×¨×™×˜
      <select id="item"></select>
    </label>

    <label>×¡×•×’ ×¦×‘×¢
      <select id="color">
        <option value="semi">×—×¦×™ ×©×§×•×£</option>
        <option value="solid">××˜×•×</option>
      </select>
    </label>

    <label>×›××•×ª ×™×—×™×“×•×ª
      <input type="number" id="qty" min="1" step="1" placeholder="×œ××©×œ 4">
    </label>

    <label>××•×¨×š ×‘××˜×¨×™×
      <input type="number" id="len" min="0" step="0.01" placeholder="×œ××©×œ 2.5">
    </label>

    <div class="row" style="margin-top:14px;">
      <button class="primary" onclick="addRow()">×”×•×¡×£</button>
      <button class="secondary" onclick="dlg.close()">×‘×™×˜×•×œ</button>
    </div>
  </dialog>

  <!-- ====== HTML template for PDF (hidden) ====== -->
  <div id="pdfWrap">
    <div id="pdfContent" class="pdf">
      <div class="pdf-header">×”×¦×¢×ª ××—×™×¨ ×œ×©×™×•×£ ×›×œ×œ×™</div>

      <div class="pdf-meta">
        <div class="box">
          <div><strong>×©× ×œ×§×•×—:</strong> <span id="pdfName">â€”</span></div>
          <div><strong>××¡×¤×¨ ×œ×§×•×—:</strong> <span id="pdfId">â€”</span></div>
          <div><strong>××™×™×œ:</strong> <span id="pdfEmail">â€”</span></div>
        </div>
        <div class="box">
          <div><strong>×ª××¨×™×š:</strong> <span id="pdfDate">â€”</span></div>
          <div><strong>××¡×³ ×”×¦×¢×”:</strong> <span id="pdfQuoteNo">6202.1.1</span></div>
        </div>
      </div>

      <table class="pdf-table">
        <thead>
          <tr>
            <th style="width:44%;">×¤×¨×™×˜</th>
            <th style="width:16%;">×¦×‘×¢</th>
            <th style="width:10%;">×›××•×ª</th>
            <th style="width:14%;">××•×¨×š (××³)</th>
            <th style="width:16%;">×¡×”×´×› (â‚ª)</th>
          </tr>
        </thead>
        <tbody id="pdfTableBody"></tbody>
      </table>

      <div class="pdf-summary">
        <div>×¡×”×´×› ×œ×ª×©×œ×•×: â‚ª <span id="pdfTotal">0.00</span></div>
      </div>

      <div class="pdf-line"></div>
      <div class="pdf-footer">
        ×”×¢×¨×”: ×”××—×™×¨ ××—×•×©×‘ ×œ×¤×™ ××˜×¨ ×¨×¥ ×•×‘×”×ª×× ×œ×¤×¨×™×˜×™× ×©× ×‘×—×¨×•.
      </div>
    </div>
  </div>

<script>
  // ===== ××—×™×¨×•×Ÿ (×ª×•×›×œ ×œ×”×¨×—×™×‘ ×œ×¤×™ ×”×¦×•×¨×š) =====
  const PRICE_LIST = {
  "×œ×˜×” / ×”×¦×œ×œ×” 20Ã—45": { semi: 4.50, solid: 4.70 },
  "×œ×•×— ×¦×•×œ ×¢×œ 10 20Ã—95": { semi: 5.20, solid: 5.50 },
  "×œ×•×— ×¦×•×œ ×¢×œ 15 20Ã—145": { semi: 6.30, solid: 6.50 },
  "×œ×•×— ×¦×•×œ ×¢×œ 20 20Ã—195": { semi: 7.30, solid: 7.50 },

  "×§×•×¨×” 3/5 32Ã—45": { semi: 4.60, solid: 4.80 },
  "×—×¦×™ ×“×§ 32Ã—70": { semi: 5.00, solid: 5.20 },
  "×§×•×¨×” 3/10 32Ã—95": { semi: 5.50, solid: 5.70 },
  "×œ×•×— ×’×œ×¨×™×” / ×“×§ 32Ã—145": { semi: 6.50, solid: 6.70 },
  "×§×•×¨×” 3/20 32Ã—195": { semi: 7.50, solid: 7.70 },

  "×§×•×¨×” 5/5 45Ã—45": { semi: 4.80, solid: 5.00 },
  "×§×•×¨×” 5/7 45Ã—70": { semi: 5.30, solid: 5.50 },
  "×§×•×¨×” 5/10 45Ã—95": { semi: 5.80, solid: 6.00 },
  "×§×•×¨×” 5/15 45Ã—145": { semi: 6.80, solid: 7.00 },
  "×§×•×¨×” 5/20 45Ã—195": { semi: 7.80, solid: 8.00 },

  "80/80 70Ã—70": { semi: 5.80, solid: 6.00 },
  "150/80 145Ã—70": { semi: 7.30, solid: 7.50 },
  "200/80 195Ã—70": { semi: 5.70, solid: 5.90 },

  "100/100 85Ã—85": { semi: 6.40, solid: 6.60 },
  "100/150 145Ã—85": { semi: 7.60, solid: 7.80 },
  "100/200 195Ã—85": { semi: 8.60, solid: 8.80 },
  "100/250 240Ã—85": { semi: 9.50, solid: 9.70 },
  "100/300 280Ã—85": { semi: 10.50, solid: 10.70 },

  "150/150 135Ã—135": { semi: 8.40, solid: 8.60 },
  "150/200 185Ã—135": { semi: 9.40, solid: 9.60 },
  "150/250 235Ã—135": { semi: 10.50, solid: 10.70 },
  "150/300 280Ã—135": { semi: 11.20, solid: 11.50 },

  "200/200 185Ã—185": { semi: 10.40, solid: 10.60 },
  "200/250 235Ã—185": { semi: 11.40, solid: 11.60 },
  "200/300 280Ã—185": { semi: 12.30, solid: 12.50 }
};


  let total = 0;

  const dlg = document.getElementById("dlg");
  const tbody = document.getElementById("tableBody");
  const grandTotal = document.getElementById("grandTotal");

  // ××™×œ×•×™ ×¨×©×™××ª ×¤×¨×™×˜×™× ×‘×—×œ×•× ×™×ª
  const itemSelect = document.getElementById("item");
  Object.keys(PRICE_LIST).forEach(name => {
    const opt = document.createElement("option");
    opt.value = name;
    opt.textContent = name;
    itemSelect.appendChild(opt);
  });

  function openDialog() {
    document.getElementById("qty").value = "";
    document.getElementById("len").value = "";
    dlg.showModal();
  }

  function addRow() {
    const item = itemSelect.value;
    const color = document.getElementById("color").value;
    const qty = Number(document.getElementById("qty").value);
    const len = Number(document.getElementById("len").value);

    if (!item || !Number.isFinite(qty) || qty <= 0 || !Number.isFinite(len) || len < 0) {
      alert("× × ×œ××œ× ×¤×¨×™×˜, ×›××•×ª ×—×™×•×‘×™×ª ×•××•×¨×š ×ª×§×™×Ÿ");
      return;
    }

    const pricePerMeter = PRICE_LIST[item][color];
    const rowPrice = pricePerMeter * qty * len;

    total += rowPrice;
    updateTotal();

    const tr = document.createElement("tr");
    tr.dataset.price = rowPrice;

    tr.innerHTML = `
      <td>${item}</td>
      <td>${color === "semi" ? "×—×¦×™ ×©×§×•×£" : "××˜×•×"}</td>
      <td>${qty}</td>
      <td>${len}</td>
      <td>${rowPrice.toFixed(2)}</td>
      <td><button class="delete-btn" title="××—×§ ×©×•×¨×”">ğŸ—‘ï¸</button></td>
    `;

    tr.querySelector(".delete-btn").addEventListener("click", () => deleteRow(tr));
    tbody.appendChild(tr);
    dlg.close();
  }

  function deleteRow(row) {
    total -= Number(row.dataset.price);
    updateTotal();
    row.remove();
  }

  function updateTotal() {
    grandTotal.textContent = total.toFixed(2);
  }

  // ===== PDF: HTML -> PDF (×¢×‘×¨×™×ª ×ª×§×™× ×”) =====
  function generatePDF() {
    // ×‘×“×™×§×•×ª ××™× ×™××œ×™×•×ª
    if (document.querySelectorAll("#tableBody tr").length === 0) {
      alert("××™×Ÿ ×¤×¨×™×˜×™× ×‘×˜×‘×œ×”. ×”×•×¡×£ ×œ×¤×—×•×ª ×¤×¨×™×˜ ××—×“ ×œ×¤× ×™ ×”×¤×§×ª PDF.");
      return;
    }

    // ××™×œ×•×™ × ×ª×•× ×™× ×œ×ª×‘× ×™×ª ×”-PDF
    document.getElementById("pdfName").innerText = customerName.value || "â€”";
    document.getElementById("pdfId").innerText = customerId.value || "â€”";
    document.getElementById("pdfEmail").innerText = customerEmail.value || "â€”";
    document.getElementById("pdfDate").innerText = new Date().toLocaleDateString("he-IL");
    document.getElementById("pdfTotal").innerText = total.toFixed(2);

    // ×‘× ×™×™×ª ×˜×‘×œ×ª PDF (×‘×œ×™ ×¢××•×“×ª ××—×™×§×”)
    const pdfBody = document.getElementById("pdfTableBody");
    pdfBody.innerHTML = "";

    document.querySelectorAll("#tableBody tr").forEach(row => {
      const c = row.querySelectorAll("td");
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${c[0].innerText}</td>
        <td>${c[1].innerText}</td>
        <td>${c[2].innerText}</td>
        <td>${c[3].innerText}</td>
        <td>${c[4].innerText}</td>
      `;
      pdfBody.appendChild(tr);
    });

    // ×”×¨××” ××ª ××–×•×¨ ×”-PDF ×¨×§ ×‘×–××Ÿ ×”×”××¨×”
    const pdfWrap = document.getElementById("pdfWrap");
    pdfWrap.style.display = "block";

    const element = document.getElementById("pdfContent");

    // ×™×¦×•× PDF
    html2pdf()
      .set({
        margin: [8, 8, 8, 8], // mm
        filename: "×”×¦×¢×ª_××—×™×¨.pdf",
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
      })
      .from(element)
      .save()
      .finally(() => {
        pdfWrap.style.display = "none";
      });
  }
</script>

</body>
</html>

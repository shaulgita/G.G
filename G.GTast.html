<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>×”×¦×¢×ª ××—×™×¨</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 16px; background:#fff; }
.section { border:1px solid #ddd; border-radius:10px; padding:14px; margin-bottom:16px; background:#fafafa; }
label { display:block; margin-top:10px; font-weight:700; }
input, select { width:100%; padding:8px; margin-top:4px; border:1px solid #d1d5db; border-radius:8px; }
button { padding:10px 16px; font-size:15px; border-radius:10px; border:0; cursor:pointer; }
.primary { background:#1f6feb; color:#fff; }
.secondary { background:#e5e7eb; }

table { width:100%; border-collapse:collapse; margin-top:12px; }
th, td { border-bottom:1px solid #ddd; padding:8px; text-align:right; }
th { background:#1f2a44; color:#fff; }

.total { margin-top:14px; font-size:18px; font-weight:800; }
.delete-btn { background:none; border:none; font-size:18px; cursor:pointer; }

.modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,.4); align-items:center; justify-content:center; }
.modal .box { background:#fff; padding:16px; border-radius:12px; width:min(520px,92vw); }

#pdfWrap { display:none; }
.pdf { direction:rtl; padding:18mm 15mm; font-family:Arial; }
.pdf table { width:100%; border-collapse:collapse; }
.pdf th { background:#1f2a44; color:#fff; padding:6px; }
.pdf td { border:1px solid #ddd; padding:6px; font-size:12px; }
</style>
</head>

<body>

<h2>×”×¤×§×ª ×”×¦×¢×ª ××—×™×¨</h2>

<div class="section">
  <h3>×¤×¨×˜×™ ×œ×§×•×—</h3>
  <label>×©× ×œ×§×•×— <input id="customerName"></label>
  <label>××¡×¤×¨ ×œ×§×•×— <input id="customerId"></label>
  <label>××™×™×œ <input id="customerEmail" type="email"></label>
</div>

<div class="section">
  <h3>×¤×¨×™×˜×™×</h3>
  <button class="primary" onclick="openModal()">â• ×”×•×¡×£ ×¤×¨×™×˜</button>

  <table>
    <thead>
      <tr>
        <th>×¤×¨×™×˜</th>
        <th>×™×“×™×™×</th>
        <th>×›××•×ª</th>
        <th>××•×¨×š ×™×—×™×“×”</th>
        <th>××•×¨×š ×›×•×œ×œ</th>
        <th>××—×™×¨ ×©×•×¨×” â‚ª</th>
        <th>××—×™×§×”</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="total">
    ×¡×”×´×›: â‚ª <span id="grandTotal">0.00</span>
  </div>

  <button class="primary" style="margin-top:12px" onclick="generatePDF()">ğŸ“„ ×”×¤×§ ×”×¦×¢×ª ××—×™×¨</button>
</div>

<!-- ××•×“××œ -->
<div class="modal" id="modal">
  <div class="box">
    <h3>×”×•×¡×¤×ª ×¤×¨×™×˜</h3>

    <label>×¤×¨×™×˜
      <select id="item"></select>
    </label>

    <label>×¡×•×’ ×¦×‘×¢
      <select id="color">
        <option value="semi">×—×¦×™ ×©×§×•×£</option>
        <option value="solid">××˜×•×</option>
      </select>
    </label>

    <label>××¡×¤×¨ ×™×“×™×™×
      <select id="hands">
        <option value="1"> ×™×“ ××—×ª </option>
        <option value="2" selected> 2 ×™×“×™×™× </option>
        <option value="3"> 3 ×™×“×™×™× </option>
      </select>
    </label>

    <label>×›××•×ª ×™×—×™×“×•×ª
      <input id="qty" type="number" min="1">
    </label>

    <label>××•×¨×š ×™×—×™×“×” (××³)
      <input id="len" type="number" step="0.01" min="0">
    </label>

    <div style="margin-top:12px">
      <button class="primary" onclick="addRow()">×”×•×¡×£</button>
      <button class="secondary" onclick="closeModal()">×‘×™×˜×•×œ</button>
    </div>
  </div>
</div>

<!-- PDF -->
<div id="pdfWrap">
  <div id="pdfContent" class="pdf">
    <h2 style="text-align:center">×”×¦×¢×ª ××—×™×¨</h2>
    <p>
      <strong>×©× ×œ×§×•×—:</strong> <span id="pdfName"></span><br>
      <strong>××¡×³ ×œ×§×•×—:</strong> <span id="pdfId"></span><br>
      <strong>××™×™×œ:</strong> <span id="pdfEmail"></span><br>
      <strong>×ª××¨×™×š:</strong> <span id="pdfDate"></span>
    </p>

    <table>
      <thead>
        <tr>
          <th>×¤×¨×™×˜</th>
          <th>×™×“×™×™×</th>
          <th>×›××•×ª</th>
          <th>××•×¨×š ×™×—×™×“×”</th>
          <th>××•×¨×š ×›×•×œ×œ</th>
          <th>××—×™×¨ â‚ª</th>
        </tr>
      </thead>
      <tbody id="pdfTable"></tbody>
    </table>

    <h3>×¡×”×´×›: â‚ª <span id="pdfTotal"></span></h3>
  </div>
</div>

<script>
const PRICE_LIST = {
  "×œ×˜×” / ×”×¦×œ×œ×” 20Ã—45": { semi: 4.50, solid: 4.70 },
  "×œ×•×— ×¦×•×œ ×¢×œ 10 20Ã—95": { semi: 5.20, solid: 5.50 }
};

const HANDS_FACTOR = {
  1: 0.6,
  2: 1.0,
  3: 1.4
};

let total = 0;
const tbody = document.getElementById("tableBody");
const itemSelect = document.getElementById("item");

Object.keys(PRICE_LIST).forEach(p => {
  const o = document.createElement("option");
  o.value = p; o.textContent = p;
  itemSelect.appendChild(o);
});

function openModal(){ modal.style.display="flex"; }
function closeModal(){ modal.style.display="none"; }

function addRow(){
  const item = itemSelect.value;
  const colorVal = color.value;
  const hands = Number(document.getElementById("hands").value);
  const qty = Number(qty.value);
  const len = Number(len.value);

  if(qty<=0 || len<=0){ alert("×›××•×ª ×•××•×¨×š ×—×™×™×‘×™× ×œ×”×™×•×ª ×—×™×•×‘×™×™×"); return; }

  const pricePerMeter = PRICE_LIST[item][colorVal];
  const factor = HANDS_FACTOR[hands];
  const totalMeters = qty * len;
  const rowPrice = totalMeters * pricePerMeter * factor;

  total += rowPrice;
  grandTotal.innerText = total.toFixed(2);

  const tr = document.createElement("tr");
  tr.dataset.price = rowPrice;
  tr.innerHTML = `
    <td>${item}</td>
    <td>${hands}</td>
    <td>${qty}</td>
    <td>${len}</td>
    <td>${totalMeters.toFixed(2)}</td>
    <td>${rowPrice.toFixed(2)}</td>
    <td><button class="delete-btn">ğŸ—‘ï¸</button></td>
  `;
  tr.querySelector("button").onclick = () => {
    total -= rowPrice;
    grandTotal.innerText = total.toFixed(2);
    tr.remove();
  };

  tbody.appendChild(tr);
  closeModal();
}

function generatePDF(){
  pdfName.innerText = customerName.value || "â€”";
  pdfId.innerText = customerId.value || "â€”";
  pdfEmail.innerText = customerEmail.value || "â€”";
  pdfDate.innerText = new Date().toLocaleDateString("he-IL");
  pdfTotal.innerText = total.toFixed(2);

  const pdfTable = document.getElementById("pdfTable");
  pdfTable.innerHTML = "";
  document.querySelectorAll("#tableBody tr").forEach(r=>{
    pdfTable.appendChild(r.cloneNode(true));
  });

  pdfWrap.style.display="block";
  html2pdf().from(pdfContent)
    .set({ filename:"×”×¦×¢×ª_××—×™×¨.pdf", jsPDF:{format:"a4"} })
    .save()
    .finally(()=>pdfWrap.style.display="none");
}
</script>

</body>
</html>
